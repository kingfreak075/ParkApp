<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menu - ParkApp</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="db-config.js"></script>
<script src="check-db-config.js"></script>
</head>
<body class="bg-app">
    <div class="app-container">
        <header class="app-header">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h1 style="font-size: 1.2rem; font-weight: 800; margin: 0;">Bentornato,</h1>
                    <div id="nome-tecnico" style="font-size: 1.1rem; color: var(--primary); font-weight: 700;">-</div>
                </div>
                <button onclick="logout()" class="btn-logout">
                    <span class="material-symbols-rounded">logout</span>
                    Esci
                </button>
            </div>
        </header>

        <main style="padding: 1rem; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <button onclick="window.location.href='parco.html'" class="menu-item">
                <span class="material-symbols-rounded">apartment</span>
                PARCO
            </button>
            <button onclick="window.location.href='manutenzioni.html'" class="menu-item">
                <span class="material-symbols-rounded">build</span>
                MANUTENZIONE
            </button>
            <button onclick="window.location.href='gestione.html'" class="menu-item">
                <span class="material-symbols-rounded">schedule</span>
                GESTIONE
            </button>
            <button onclick="window.location.href='montaggi.html'" class="menu-item">
    <span class="material-symbols-rounded">construction</span>
    MONTAGGIO
</button>
            <button onclick="window.location.href='agenda.html'" class="menu-item">
                <span class="material-symbols-rounded">event_note</span>
                AGENDA
            </button>
            <button onclick="window.location.href='calendario.html'" class="menu-item">
                <span class="material-symbols-rounded">calendar_month</span>
                CALENDARIO
            </button>
            <button onclick="window.location.href='gestione_veicoli.html'" class="menu-item">
                <span class="material-symbols-rounded">directions_car</span>
                GESTIONE AUTO
            </button>
            <button onclick="window.location.href='note_spese.html'" class="menu-item">
                <span class="material-symbols-rounded">payments</span>
                NOTE SPESE
            </button>
            <button class="menu-item disabled">
                <span class="material-symbols-rounded">emergency</span>
                REPERIBILITÀ
            </button>
            <button onclick="window.location.href='config.html'" class="menu-item">
                <span class="material-symbols-rounded">settings</span>
                CONFIGURAZIONE
            </button>
        </main>

        <footer class="app-footer">
            <span class="footer-text">EDIT BY KINGFREAK Version 1.0</span>
        </footer>
    </div>

<script>
    // Carica nome tecnico
    document.getElementById('nome-tecnico').innerText = localStorage.getItem('tecnico_loggato') || "Tecnico";
    
    // Controlla configurazione database
    document.addEventListener('DOMContentLoaded', function() {
        const configInfo = getDbConfigInfo();
        
        // Aggiungi indicatore visivo se configurato
        if (configInfo.configured) {
            const header = document.querySelector('.app-header');
            if (header) {
                // Crea indicatore verde
                const indicator = document.createElement('div');
                indicator.id = 'db-status-indicator';
                indicator.style.cssText = `
                    position: absolute;
                    top: 15px;
                    right: 15px;
                    width: 10px;
                    height: 10px;
                    background: #22c55e;
                    border-radius: 50%;
                    border: 2px solid white;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    cursor: help;
                    z-index: 10;
                `;
                indicator.title = `DB configurato\n${configInfo.urlShort}\n${configInfo.timestamp ? 'Dal: ' + configInfo.timestamp : ''}`;
                header.style.position = 'relative';
                header.appendChild(indicator);
                
                // Tooltip hover
                indicator.addEventListener('mouseenter', function() {
                    const tooltip = document.createElement('div');
                    tooltip.id = 'db-tooltip';
                    tooltip.style.cssText = `
                        position: absolute;
                        top: 25px;
                        right: 0;
                        background: white;
                        padding: 10px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        font-size: 0.75rem;
                        color: #475569;
                        z-index: 100;
                        min-width: 200px;
                        border: 1px solid #e2e8f0;
                    `;
                    tooltip.innerHTML = `
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 5px;">Database Configurato</div>
                        <div style="margin-bottom: 3px;"><strong>URL:</strong> ${configInfo.urlShort}</div>
                        <div style="margin-bottom: 3px;"><strong>Configurato il:</strong> ${configInfo.timestamp || '-'}</div>
                        <div><strong>Tabelle sincronizzate:</strong> ${configInfo.table ? 'Sì (' + configInfo.table + ')' : 'No'}</div>
                    `;
                    this.appendChild(tooltip);
                });
                
                indicator.addEventListener('mouseleave', function() {
                    const tooltip = document.getElementById('db-tooltip');
                    if (tooltip) tooltip.remove();
                });
            }
        } else {
            // Se non configurato, mostra avviso discreto
            const header = document.querySelector('.app-header');
            if (header) {
                const warning = document.createElement('div');
                warning.style.cssText = `
                    position: absolute;
                    top: 15px;
                    right: 15px;
                    width: 10px;
                    height: 10px;
                    background: #f59e0b;
                    border-radius: 50%;
                    border: 2px solid white;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    cursor: pointer;
                    z-index: 10;
                `;
                warning.title = 'Database non configurato - Clicca per configurare';
                warning.onclick = function() {
                    if (confirm('Database non configurato. Vuoi andare alla configurazione?')) {
                        window.location.href = 'config.html';
                    }
                };
                header.style.position = 'relative';
                header.appendChild(warning);
            }
        }
        
        // Controlla se mostrare overlay di blocco (opzionale)
        // checkDbConfig();
    });

    function logout() {
        if(confirm("Vuoi uscire e cambiare utente?")) {
            localStorage.removeItem('tecnico_loggato');
            window.location.href = 'index.html';
        }
    }
    
    // Funzione per verificare rapidamente lo stato DB (per debug)
    window.checkDbStatus = function() {
        const config = getDbConfigInfo();
        alert(`Stato DB:\nConfigurato: ${config.configured ? 'Sì' : 'No'}\nURL: ${config.urlShort}\nUltimo test: ${config.timestamp || 'Mai'}`);
        return config.configured;
    };
</script>

    <style>
        .btn-logout {
            background: #fee2e2;
            color: #ef4444;
            border: none;
            padding: 8px 12px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .menu-item {
            background: white;
            border: none;
            border-radius: 16px;
            padding: 25px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--primary);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .menu-item:active { transform: scale(0.95); }
        .menu-item .material-symbols-rounded { font-size: 2.2rem; }
        .disabled { opacity: 0.5; color: #64748b; background: #f1f5f9; }
    </style>
</body>
</html>